# ğŸ† ç¾æ´²è±¹ä¸ªä½“è¯†åˆ«ç³»ç»Ÿ (Jaguar Re-ID)

åŸºäºæ·±åº¦å­¦ä¹ çš„ç¾æ´²è±¹ä¸ªä½“é‡è¯†åˆ«é¡¹ç›®ï¼Œä½¿ç”¨é¢„è®­ç»ƒ ResNet50/ViT è¿›è¡Œè¿ç§»å­¦ä¹ ã€‚

![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)
![PyTorch](https://img.shields.io/badge/PyTorch-2.0+-red.svg)
![License](https://img.shields.io/badge/License-MIT-green.svg)

---

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹)
- [è®¾å¤‡é…ç½®](#è®¾å¤‡é…ç½®)
- [ç¯å¢ƒé…ç½®](#ç¯å¢ƒé…ç½®)
- [æ•°æ®é›†ç»“æ„](#æ•°æ®é›†ç»“æ„)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [è®­ç»ƒæ¨¡å‹](#è®­ç»ƒæ¨¡å‹)
- [è¯„ä¼°æ¨¡å‹](#è¯„ä¼°æ¨¡å‹)
- [ç”Ÿæˆæäº¤æ–‡ä»¶](#ç”Ÿæˆæäº¤æ–‡ä»¶)
- [å®éªŒç»“æœ](#å®éªŒç»“æœ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ—¨åœ¨è§£å†³ç¾æ´²è±¹ä¸ªä½“è¯†åˆ«é—®é¢˜ã€‚é€šè¿‡åˆ†æç¾æ´²è±¹èº«ä¸Šç‹¬ç‰¹çš„æ–‘çº¹æ¨¡å¼ï¼Œå®ç°å¯¹ä¸åŒä¸ªä½“çš„åŒºåˆ†å’Œè¯†åˆ«ã€‚

### ä¸»è¦ç‰¹ç‚¹

- âœ… ä½¿ç”¨ ImageNet é¢„è®­ç»ƒæƒé‡è¿›è¡Œè¿ç§»å­¦ä¹ 
- âœ… æ”¯æŒ ResNet50 å’Œ ViT ä¸¤ç§éª¨å¹²ç½‘ç»œ
- âœ… åŠ æƒé‡‡æ ·å¤„ç†ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜
- âœ… æ”¯æŒ GPU/CPU è®­ç»ƒå’Œæ¨ç†

### æŠ€æœ¯æ¶æ„

```
è¾“å…¥å›¾ç‰‡ (224x224)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¢„è®­ç»ƒ Backbone â”‚  â† ResNet50 / ViT
â”‚  (ç‰¹å¾æå–)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç‰¹å¾å±‚ (512ç»´)  â”‚  â† FC + BN + ReLU + Dropout
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ†ç±»å™¨ (31ç±»)   â”‚  â† ç¾æ´²è±¹ä¸ªä½“ç±»åˆ«
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---
## ğŸ‹ï¸ è®¾å¤‡é…ç½®
### äº‘æœåŠ¡å™¨
äº‘æœåŠ¡å™¨ç§ç±»ï¼Œå¾ˆå¤šè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨OpenIäº‘æœåŠ¡å¹³å°ï¼Œè¿›è¡Œæ¨¡å‹è®­ç»ƒã€‚
### ğŸ“ æ•°æ®é›†ç»“æ„ä¸ä¸Šä¼ 
```
dataset/
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ train.csv          # è®­ç»ƒæ ‡æ³¨æ–‡ä»¶
â”‚   â”œâ”€â”€ train_0001.png     # è®­ç»ƒå›¾ç‰‡
â”‚   â”œâ”€â”€ train_0002.png
â”‚   â””â”€â”€ ...
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ test_0001.png      # æµ‹è¯•å›¾ç‰‡
â”‚   â”œâ”€â”€ test_0002.png
â”‚   â””â”€â”€ ...
â””â”€â”€ test.csv               # æµ‹è¯•é…å¯¹æ–‡ä»¶
```

### train.csv æ ¼å¼

| filename | ground_truth |
|----------|--------------|
| train_0001.png | Abril |
| train_0002.png | Abril |
| train_0003.png | Bagua |

### test.csv æ ¼å¼

| row_id | image1 | image2 |
|--------|--------|--------|
| 0 | test_0001.png | test_0002.png |
| 1 | test_0001.png | test_0003.png |

---
ä¸Šè¿°æ•°æ®é›†trainï¼ˆ1895å¼ ã€13.5GBï¼‰ã€testï¼ˆ371å¼ ã€2.5GBï¼‰ï¼Œæ•°æ®å†…å­˜å æ¯”é«˜ï¼Œä¼ è¾“æœåŠ¡å™¨å›°éš¾ï¼Œç»™å‡ºå¦‚ä¸‹ç‰¹æ®Šä¼ è¾“æ–¹å¼ï¼š
### SDKä¼ è¾“
```bash
import openi  #OpenIä¸­pythonçš„SDKä¼ è¾“
import os

# 1. ç™»å½•åˆ°OpenIå¹³å°ï¼ˆéœ€è¦è·å–è®¿é—®ä»¤ç‰Œï¼‰
token = "xxx"  # ä»å¹³å°ä¸­è·å–tokenï¼ˆè®¾ç½®ï¼‰
openi.login(token=token)  # ä½¿ç”¨ token ç™»å½•å¹³å°

# 2. éªŒè¯ç™»å½•çŠ¶æ€
user_info = openi.whoami() # è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
# 3. è®¾ç½®æ•°æ®é›†ä»“åº“ä¿¡æ¯
repo_id = "xxx/xxxx"  # æ ¼å¼: ç”¨æˆ·å/ä»“åº“å
local_dataset_path = "xxx\\xxx\\xxx"  # æœ¬åœ°æ•°æ®é›†è·¯å¾„

# 4. ä¸Šä¼ æ•°æ®é›†
    result = openi.openi_upload_file(
        repo_id=repo_id,
        file_or_folder_path=local_dataset_path,
        repo_type="dataset"  # æŒ‡å®šä¸ºæ•°æ®é›†ç±»å‹)
```
## ğŸ”§ ç¯å¢ƒé…ç½®

### ä¾èµ–å®‰è£…

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰
conda create -n jaguar python=3.10
conda activate jaguar

# å®‰è£…ä¾èµ–
pip install torch torchvision
pip install pandas numpy pillow
pip install scikit-learn tqdm
pip install timm  # å¦‚æœä½¿ç”¨ ViT
```
### å¿«æ·å®‰è£…
```bash
# ä½¿ç”¨æ¸…åæºå®‰è£… requirements.txt ä¸­çš„æ‰€æœ‰ä¾èµ–
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt
```

### ç¡¬ä»¶è¦æ±‚

| é…ç½® | æœ€ä½è¦æ±‚ | æ¨èé…ç½® |
|------|---------|---------|
| GPU | æ—  (å¯ç”¨CPU) | NVIDIA V100 32GB |
| å†…å­˜ | 8GB | 16GB+ |
| ç¡¬ç›˜ | 5GB | 10GB+ |

---



## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/your-username/jaguar-reid.git
cd jaguar-reid
```

### 2. è®­ç»ƒæ¨¡å‹

```bash
python train.py --data_dir /path/to/dataset/train --batch_size 64 --epochs 50
```

### 3. è¯„ä¼°æ¨¡å‹

```bash
python evaluate.py --model_path checkpoints/best_model.pth --data_dir /path/to/dataset/train
```

### 4. ç”Ÿæˆæäº¤æ–‡ä»¶

```bash
python test.py --model_path checkpoints/best_model.pth --test_csv test.csv --test_img_dir /path/to/test
```

---

## ğŸ‹ï¸ è®­ç»ƒæ¨¡å‹

### åŸºæœ¬ç”¨æ³•

```bash
python train.py --data_dir /tmp/dataset/train --batch_size 64 --epochs 50 --lr 0.001
```

### å®Œæ•´å‚æ•°è¯´æ˜

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--data_dir` | å¿…å¡« | è®­ç»ƒæ•°æ®ç›®å½• |
| `--batch_size` | 32 | æ‰¹æ¬¡å¤§å° |
| `--epochs` | 50 | è®­ç»ƒè½®æ•° |
| `--lr` | 0.001 | å­¦ä¹ ç‡ |
| `--val_split` | 0.1 | éªŒè¯é›†æ¯”ä¾‹ |
| `--save_dir` | checkpoints | æ¨¡å‹ä¿å­˜ç›®å½• |

### è®­ç»ƒç¤ºä¾‹

```bash
# ä½¿ç”¨ ResNet50 (æ¨è)
python train.py \
    --data_dir /tmp/dataset/train \
    --batch_size 64 \
    --epochs 50 \
    --lr 0.005

# ä½¿ç”¨è¾ƒå°å­¦ä¹ ç‡é˜²æ­¢è¿‡æ‹Ÿåˆ
python train.py \
    --data_dir /tmp/dataset/train \
    --batch_size 32 \
    --epochs 30 \
    --lr 0.001
```
### è®­ç»ƒè¾“å‡ºç¤ºä¾‹
```
âœ… CUDA å¯ç”¨
   GPU: Tesla V100S-PCIE-32GB
   æ˜¾å­˜: 31.73 GB
ä½¿ç”¨è®¾å¤‡: cuda
åŠ è½½æ•°æ®é›†: 1895 å¼ å›¾ç‰‡, 31 ä¸ªç±»åˆ«
ç±»åˆ«åˆ†å¸ƒ: æœ€å¤š 183 å¼ , æœ€å°‘ 13 å¼ 
è®­ç»ƒé›†: 1705 å¼ , éªŒè¯é›†: 190 å¼ 

============================================================
Epoch 1/50
============================================================
  Batch [0/26] Loss: 3.4841 Acc: 3.12%
  Batch [10/26] Loss: 2.1532 Acc: 45.23%
  Batch [20/26] Loss: 1.4521 Acc: 68.45%

ğŸ“Š Epoch 1 ç»“æœ:
   è®­ç»ƒ - Loss: 1.8234, Acc: 52.34%
   éªŒè¯ - Loss: 1.2341, Acc: 65.26%
âœ… ä¿å­˜æœ€ä½³æ¨¡å‹ï¼Œå‡†ç¡®ç‡: 65.26%
```
---

## ğŸ“Š è¯„ä¼°æ¨¡å‹

### åŸºæœ¬ç”¨æ³•

```bash
python evaluate.py --model_path checkpoints/best_model.pth --data_dir /tmp/dataset/train
```

### è¯„ä¼°æŒ‡æ ‡

- **åˆ†ç±»å‡†ç¡®ç‡**: æ­£ç¡®åˆ†ç±»çš„æ ·æœ¬æ¯”ä¾‹
- **mAP**: å¹³å‡ç²¾åº¦å‡å€¼ï¼Œè¡¡é‡æ£€ç´¢æ•ˆæœ
- **Top-1 å‡†ç¡®ç‡**: æœ€ç›¸ä¼¼æ ·æœ¬æ˜¯åŒä¸€ä¸ªä½“çš„æ¯”ä¾‹
- **Top-5 å‡†ç¡®ç‡**: å‰5ä¸ªæœ€ç›¸ä¼¼æ ·æœ¬åŒ…å«åŒä¸€ä¸ªä½“çš„æ¯”ä¾‹

### è¾“å‡ºç¤ºä¾‹

```
============================================================
ğŸ“Š è¯„ä¼°ç»“æœ
============================================================
  åˆ†ç±»å‡†ç¡®ç‡: 81.05%
  mAP: 0.9329 (93.29%)
  Top-1 æ£€ç´¢å‡†ç¡®ç‡: 92.11%
  Top-5 æ£€ç´¢å‡†ç¡®ç‡: 94.21%
============================================================
```

---

## ğŸ“¤ ç”Ÿæˆæäº¤æ–‡ä»¶

### åŸºæœ¬ç”¨æ³•

```bash
python test.py \
    --model_path checkpoints/best_model.pth \
    --test_csv test.csv \
    --test_img_dir /tmp/dataset/test \
    --output submission.csv
```

### è¾“å‡ºæ ¼å¼

```csv
row_id,similarity
0,0.8234
1,0.1234
2,0.9521
...
```

---


## ğŸ“‚ é¡¹ç›®ç»“æ„

```
jaguar-reid/
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ train.py               # è®­ç»ƒè„šæœ¬
â”œâ”€â”€ test.py                # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ evaluate.py            # è¯„ä¼°è„šæœ¬
â”œâ”€â”€ model.py               # æ¨¡å‹å®šä¹‰
â”œâ”€â”€ checkpoints/           # æ¨¡å‹ä¿å­˜ç›®å½•
â”‚   â””â”€â”€ best_model.pth     # æœ€ä½³æ¨¡å‹æƒé‡
â”œâ”€â”€ data/                  # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ train/
â”‚   â””â”€â”€ test/
â””â”€â”€ submission.csv         # æäº¤æ–‡ä»¶
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: è®­ç»ƒæ—¶ Acc ä¸€ç›´æ˜¯ 0%ï¼Ÿ

**åŸå› **: å¯èƒ½æ˜¯æŸå¤±å‡½æ•°é…ç½®é—®é¢˜ï¼ˆå¦‚ ArcFace å‚æ•°ä¸å½“ï¼‰

**è§£å†³**: ä½¿ç”¨ç®€å•çš„äº¤å‰ç†µæŸå¤±ï¼š
```python
criterion = nn.CrossEntropyLoss(label_smoothing=0.1)
```

### Q2: GPU åˆ©ç”¨ç‡æ˜¾ç¤º 0%ï¼Ÿ

**åŸå› **: `nvidia-smi` æ˜¾ç¤ºçš„æ˜¯ç¬æ—¶å€¼ï¼Œæ•°æ®åŠ è½½æ—¶ GPU ç©ºé—²

**è§£å†³**: æŸ¥çœ‹æ˜¾å­˜å ç”¨ï¼Œæœ‰å ç”¨è¯´æ˜æ­£åœ¨ä½¿ç”¨ GPU

### Q3: è¿‡æ‹Ÿåˆæ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨æ—©åœï¼ˆEarly Stoppingï¼‰
- å¢åŠ æ•°æ®å¢å¼º
- å‡å°å­¦ä¹ ç‡
- å¢åŠ  Dropout

### Q4: è·¯å¾„é”™è¯¯ FileNotFoundErrorï¼Ÿ

**æ£€æŸ¥æ•°æ®ç›®å½•ç»“æ„**:
```bash
ls -la /tmp/dataset/train/
head /tmp/dataset/train/train.csv
```

---

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

---

## ğŸ™ è‡´è°¢

- [PyTorch](https://pytorch.org/)
- [timm](https://github.com/huggingface/pytorch-image-models)
- [OpenI å¹³å°](https://openi.pcl.ac.cn/)

---

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»ï¼š

- é‚®ç®±: 17763221787@163.com


---

<p align="center">
  <b>â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼â­</b>
</p>
